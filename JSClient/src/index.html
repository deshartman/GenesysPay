<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twilio Call Capture</title>
    <link href="https://unpkg.com/@twilio-paste/design-tokens@10.15.0/dist/tokens.custom-properties.css" rel="stylesheet">
    <link href="./styles.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="text/javascript" src="//media.twiliocdn.com/sdk/js/sync/v3.2/twilio-sync.min.js"></script>
</head>
<body>

<!-- Sign In View -->
<main id="signInView" class="view-container">
    <div class="signin-wrapper">
        <form onsubmit="event.preventDefault(); startCapture();" class="signin-form">
            <div class="logo-container">
                <img src="./img/twilio-ar21.svg" alt="Twilio" width="180" height="90">
            </div>

            <h1 class="page-title">Twilio Agent Assisted Demo</h1>

            <div class="form-group">
                <div class="input-wrapper">
                    <input
                        type="text"
                        class="input-field"
                        id="callSid"
                        placeholder=" "
                        maxlength="34"
                        autocomplete="off"
                    >
                    <label for="callSid" class="floating-label">Paste an active call SID here</label>
                    <div class="input-border"></div>
                </div>
                <div id="callSidValidation" class="validation-message" style="display: none;">
                    <svg class="validation-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M13.5 4.5L6 12L2.5 8.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Valid Call SID format
                </div>
            </div>

            <button class="btn btn-primary btn-full" id="signInBtn" type="submit">
                <span id="signInBtnText">Sign in</span>
                <span id="signInBtnSpinner" class="spinner" style="display: none;"></span>
            </button>
        </form>

        <div id="errorMessage" class="alert alert-error" style="display: none;">
            <div class="alert-content">
                <svg class="alert-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2"/>
                    <path d="M10 6v4M10 13v1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span id="errorText" class="alert-text"></span>
            </div>
            <button type="button" class="alert-close" onclick="hideError()" aria-label="Close">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M12 4L4 12M4 4l8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
    </div>
</main>

<!-- Payment View -->
<main id="paymentView" class="view-container" style="display: none;">
    <div class="payment-wrapper">
        <div class="logo-container">
            <img src="./img/twilio-ar21.svg" alt="Twilio" width="180" height="90">
        </div>

        <div class="payment-card">
            <div class="card-header">
                <h2 class="card-title">Payment Details</h2>
            </div>

            <div class="card-body">
                <div class="metadata-section">
                    <div class="metadata-row">
                        <span class="metadata-label">Call ID:</span>
                        <span class="badge badge-neutral" id="callSidDisplay"></span>
                    </div>
                    <div class="metadata-row">
                        <span class="metadata-label">Payment ID:</span>
                        <span class="badge badge-neutral" id="paymentSidDisplay"></span>
                    </div>
                    <div class="metadata-row">
                        <span class="metadata-label">Status:</span>
                        <span class="badge badge-secondary" id="syncStatus">Disconnected</span>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-group-label">Card Number</label>
                    <div class="input-group-row">
                        <input class="input-field input-readonly" type="text" id="card" readonly>
                        <button class="btn btn-reset" id="resetCardBtn" onclick="resetCardInput()">Reset</button>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-group-label">Security Code</label>
                    <div class="input-group-row">
                        <input class="input-field input-readonly" type="text" id="cvc" readonly>
                        <button class="btn btn-reset" id="resetCvcBtn" onclick="resetCvcInput()">Reset</button>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-group-label">Expiration Date</label>
                    <div class="input-group-row">
                        <input class="input-field input-readonly" type="text" id="date" readonly>
                        <button class="btn btn-reset" id="resetDateBtn" onclick="resetDateInput()">Reset</button>
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <button class="btn btn-success" id="submitBtn" onclick="submit()" disabled>Submit Payment</button>
                <button class="btn btn-destructive" id="cancelBtn" onclick="cancel()">Cancel</button>
            </div>
        </div>
    </div>
</main>

<script type="module" src="payment.js"></script>
<script type="module" src="index.js"></script>
</body>
</html>
